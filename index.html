<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sigbots Parts ‚Äî ACM Purdue</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
  :root {
    --gold: #CFB991; --gold-bright: #DAAA00;
    --black: #1a1a1a; --dark: #0f0f0f;
    --panel: #242424; --panel2: #2e2e2e;
    --border: #3a3a3a; --text: #e8e8e8; --muted: #888;
    --green: #4caf72; --red: #e05252; --blue: #4a90e0;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--dark); color: var(--text); font-family: 'Barlow', sans-serif; min-height: 100vh; }

  nav {
    background: var(--black); border-bottom: 2px solid var(--gold);
    padding: 0 16px; display: flex; align-items: center;
    justify-content: space-between; height: 60px;
    position: sticky; top: 0; z-index: 100; gap: 8px;
  }
  .nav-logo { font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 20px; color: var(--gold); letter-spacing: 1px; white-space: nowrap; flex-shrink: 0; }
  .nav-logo span { color: var(--text); font-weight: 400; }
  .nav-tabs { display: flex; gap: 2px; flex-shrink: 0; }
  .nav-tab { background: none; border: none; color: var(--muted); font-family: 'Barlow Condensed', sans-serif; font-size: 14px; font-weight: 600; letter-spacing: 1px; padding: 8px 12px; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all .2s; text-transform: uppercase; }
  .nav-tab:hover { color: var(--gold); }
  .nav-tab.active { color: var(--gold); border-bottom-color: var(--gold); }
  .nav-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  .cart-btn { background: var(--gold); color: var(--black); border: none; padding: 8px 14px; border-radius: 4px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 14px; letter-spacing: 1px; cursor: pointer; transition: background .2s; display: flex; align-items: center; gap: 6px; }
  .cart-btn:hover { background: var(--gold-bright); }
  .cart-count { background: var(--black); color: var(--gold); border-radius: 50%; width: 20px; height: 20px; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: 900; }
  .admin-link { color: var(--gold); font-size: 12px; cursor: pointer; background: var(--panel2); border: 1px solid var(--gold); padding: 6px 10px; border-radius: 4px; font-family: 'Barlow Condensed', sans-serif; font-weight: 600; letter-spacing: 1px; white-space: nowrap; transition: background .2s; }
  .admin-link:hover { background: rgba(207,185,145,.15); }

  .page { display: none; padding: 24px 20px; max-width: 1100px; margin: 0 auto; }
  .page.active { display: block; }

  .parts-toolbar { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
  .search-input { flex: 1; min-width: 180px; background: var(--panel); border: 1px solid var(--border); color: var(--text); padding: 10px 16px; border-radius: 6px; font-family: 'Barlow', sans-serif; font-size: 14px; outline: none; transition: border .2s; }
  .search-input:focus { border-color: var(--gold); }

  .btn { background: var(--gold); color: var(--black); border: none; padding: 10px 18px; border-radius: 6px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 14px; letter-spacing: 1px; cursor: pointer; transition: background .2s; white-space: nowrap; }
  .btn:hover { background: var(--gold-bright); }
  .btn.secondary { background: var(--panel2); color: var(--text); border: 1px solid var(--border); }
  .btn.secondary:hover { background: var(--border); }
  .btn.danger { background: var(--red); color: #fff; }
  .btn.danger:hover { background: #c04040; }

  .parts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); gap: 14px; }
  .part-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; transition: border-color .2s, transform .15s; display: flex; flex-direction: column; }
  .part-card:hover { border-color: var(--gold); transform: translateY(-2px); }
  .part-img { width: 100%; height: 140px; background: var(--panel2); display: flex; align-items: center; justify-content: center; font-size: 40px; flex-shrink: 0; overflow: hidden; }
  .part-img img { width: 100%; height: 100%; object-fit: cover; }
  .part-body { padding: 12px; flex: 1; display: flex; flex-direction: column; gap: 5px; }
  .part-name { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 17px; }
  .part-price { color: var(--gold); font-weight: 600; font-size: 14px; }
  .part-tag { display: inline-block; background: var(--panel2); border: 1px solid var(--border); border-radius: 3px; padding: 2px 7px; font-size: 11px; color: var(--muted); width: fit-content; }
  .part-link { color: var(--muted); font-size: 12px; text-decoration: none; }
  .part-link:hover { color: var(--gold); }
  .part-footer { padding: 10px 12px; border-top: 1px solid var(--border); display: flex; gap: 8px; align-items: center; }
  .qty-input { width: 54px; background: var(--panel2); border: 1px solid var(--border); color: var(--text); padding: 6px 8px; border-radius: 4px; font-size: 14px; text-align: center; outline: none; }
  .add-btn { flex: 1; background: var(--gold); color: var(--black); border: none; padding: 7px; border-radius: 4px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; letter-spacing: 1px; font-size: 14px; cursor: pointer; transition: background .2s; }
  .add-btn:hover { background: var(--gold-bright); }
  .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); grid-column: 1/-1; }
  .empty-state .big { font-size: 48px; margin-bottom: 12px; }

  .cart-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.6); z-index: 200; }
  .cart-overlay.open { display: block; }
  .cart-drawer { position: fixed; right: -420px; top: 0; bottom: 0; width: 400px; max-width: 100vw; background: var(--panel); border-left: 2px solid var(--gold); z-index: 201; display: flex; flex-direction: column; transition: right .3s ease; }
  .cart-drawer.open { right: 0; }
  .cart-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
  .cart-title { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 20px; }
  .close-btn { background: var(--panel2); border: 1px solid var(--border); color: var(--text); font-size: 16px; cursor: pointer; width: 34px; height: 34px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: background .2s; flex-shrink: 0; }
  .close-btn:hover { background: var(--border); }
  .cart-items { flex: 1; padding: 14px; overflow-y: auto; }
  .cart-item { background: var(--panel2); border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-bottom: 8px; display: flex; gap: 10px; align-items: flex-start; }
  .cart-item-info { flex: 1; }
  .cart-item-name { font-weight: 600; font-size: 14px; }
  .cart-item-meta { color: var(--muted); font-size: 12px; margin-top: 3px; }
  .cart-item-remove { background: none; border: none; color: var(--red); cursor: pointer; font-size: 18px; padding: 0 4px; }
  .cart-footer { padding: 14px; border-top: 1px solid var(--border); flex-shrink: 0; }
  .finp { width: 100%; background: var(--panel2); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 6px; font-family: 'Barlow', sans-serif; font-size: 14px; margin-bottom: 10px; outline: none; transition: border .2s; }
  .finp:focus { border-color: var(--gold); }
  textarea.finp { resize: vertical; min-height: 65px; }
  .pay-opts { display: flex; gap: 8px; margin-bottom: 12px; }
  .pay-opt { flex: 1; background: var(--panel2); border: 2px solid var(--border); color: var(--text); padding: 10px 6px; border-radius: 6px; cursor: pointer; transition: all .2s; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 3px; }
  .pay-opt:hover { border-color: var(--gold); }
  .pay-opt.active { border-color: var(--gold); background: rgba(207,185,145,.1); }
  .pay-opt-icon { font-size: 18px; }
  .pay-opt-title { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 13px; }
  .pay-opt-sub { font-size: 10px; opacity: .7; }
  .cart-total { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 18px; margin-bottom: 10px; }
  .cart-total span { color: var(--gold); }

  .section-title { font-family: 'Barlow Condensed', sans-serif; font-size: 26px; font-weight: 700; margin-bottom: 16px; }
  .order-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; overflow: hidden; }
  .order-card-header { padding: 14px 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .order-name { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 18px; }
  .order-date { color: var(--muted); font-size: 12px; margin-left: auto; }
  .badge { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 11px; letter-spacing: .8px; padding: 3px 9px; border-radius: 20px; text-transform: uppercase; white-space: nowrap; }
  .badge-pending  { background: #3a3020; color: var(--gold); }
  .badge-approved { background: #1a3020; color: var(--green); }
  .badge-denied   { background: #3a1a1a; color: var(--red); }
  .badge-modified { background: #1a2540; color: var(--blue); }
  .badge-ordered  { background: #2a2040; color: #a070e0; }
  .badge-shipped  { background: #1a3030; color: #50c0c0; }
  .badge-leadpay  { background: #1a2a1a; color: #80c080; }
  .badge-selfpay  { background: #2a1a40; color: #c090f0; }
  .order-items { padding: 12px 18px; }
  .order-item-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid var(--border); font-size: 14px; }
  .order-item-row:last-child { border-bottom: none; }
  .order-notes { padding: 6px 18px 12px; color: var(--muted); font-size: 13px; font-style: italic; }
  .order-admin-note { padding: 6px 18px; color: var(--blue); font-size: 13px; }
  .order-total-bar { padding: 10px 18px; background: var(--panel2); font-weight: 600; text-align: right; font-size: 14px; }
  .order-total-bar span { color: var(--gold); }
  .admin-actions { padding: 12px 18px; border-top: 1px solid var(--border); display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .admin-select { background: var(--panel2); border: 1px solid var(--border); color: var(--text); padding: 7px 10px; border-radius: 4px; font-size: 13px; cursor: pointer; outline: none; }

  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.8); z-index: 300; align-items: center; justify-content: center; padding: 20px; }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--panel); border: 1px solid var(--gold); border-radius: 10px; padding: 26px; width: 100%; max-width: 460px; max-height: 90vh; overflow-y: auto; }
  .modal h3 { font-family: 'Barlow Condensed', sans-serif; font-size: 22px; font-weight: 700; margin-bottom: 18px; }
  .form-group { margin-bottom: 13px; }
  .form-label { font-size: 12px; color: var(--muted); margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: .5px; }
  .form-control { width: 100%; background: var(--panel2); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 6px; font-family: 'Barlow', sans-serif; font-size: 14px; outline: none; transition: border .2s; }
  .form-control:focus { border-color: var(--gold); }
  .modal-actions { display: flex; gap: 10px; margin-top: 18px; justify-content: flex-end; }

  .img-upload-area { border: 2px dashed var(--border); border-radius: 6px; padding: 20px; text-align: center; cursor: pointer; transition: border-color .2s; background: var(--panel2); }
  .img-upload-area:hover { border-color: var(--gold); }
  .img-upload-area.has-img { border-style: solid; border-color: var(--gold); padding: 8px; }
  .img-upload-area p { color: var(--muted); font-size: 13px; margin-top: 6px; }

  /* Admin buy list */
  .buy-item {
    display: flex; align-items: flex-start; gap: 12px;
    padding: 10px 0; border-bottom: 1px solid var(--border);
  }
  .buy-item:last-child { border-bottom: none; }
  .buy-item-num {
    background: var(--gold); color: var(--black);
    font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
    font-size: 12px; border-radius: 50%; width: 22px; height: 22px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;
  }
  .buy-item-info { flex: 1; min-width: 0; }
  .buy-item-name { font-weight: 600; font-size: 15px; margin-bottom: 3px; }
  .buy-item-link { color: var(--gold); font-size: 12px; text-decoration: none; word-break: break-all; display: block; margin-bottom: 4px; }
  .buy-item-link:hover { color: var(--gold-bright); text-decoration: underline; }
  .buy-item-link.no-link { color: var(--muted); font-style: italic; }
  .buy-item-price { font-size: 13px; color: var(--muted); }
  .buy-item-qty {
    background: var(--panel2); border: 1px solid var(--border);
    border-radius: 6px; padding: 6px 12px; text-align: center; flex-shrink: 0;
  }
  .buy-item-qty .qty-num { font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 22px; color: var(--gold); line-height: 1; }
  .buy-item-qty .qty-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
  .buy-item-sub { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 16px; color: var(--text); flex-shrink: 0; align-self: center; min-width: 70px; text-align: right; }

  .admin-tabs { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; }
  .admin-tab { background: var(--panel2); border: 1px solid var(--border); color: var(--muted); padding: 8px 16px; border-radius: 4px; font-family: 'Barlow Condensed', sans-serif; font-size: 14px; cursor: pointer; transition: all .2s; font-weight: 600; letter-spacing: 1px; }
  .admin-tab:hover { border-color: var(--gold); color: var(--gold); }
  .admin-tab.active { background: var(--gold); color: var(--black); border-color: var(--gold); }

  .parts-list-item { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; padding: 12px 14px; margin-bottom: 8px; display: flex; gap: 12px; align-items: center; }
  .parts-list-thumb { width: 50px; height: 50px; border-radius: 4px; background: var(--panel2); flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; overflow: hidden; }
  .parts-list-thumb img { width: 100%; height: 100%; object-fit: cover; }
  .parts-list-info { flex: 1; }
  .parts-list-name { font-weight: 600; font-size: 15px; }
  .parts-list-meta { color: var(--muted); font-size: 12px; margin-top: 2px; }

  /* Loading spinner */
  .loading { display: flex; align-items: center; justify-content: center; padding: 60px; color: var(--muted); gap: 12px; grid-column: 1/-1; }
  .spinner { width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--gold); border-radius: 50%; animation: spin .7s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px); background: #1e3a28; color: #7dd99a; border: 1px solid #3a7a50; padding: 12px 24px; border-radius: 6px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 15px; z-index: 500; transition: transform .3s; white-space: nowrap; }
  .toast.show { transform: translateX(-50%) translateY(0); }

  @media (max-width: 520px) {
    .nav-logo { font-size: 15px; }
    .parts-grid { grid-template-columns: 1fr 1fr; }
    .cart-drawer { width: 100vw; }
    .nav-tab { font-size: 12px; padding: 8px 8px; }
    .admin-link { font-size: 11px; padding: 5px 8px; }
  }
</style>
</head>
<body>

<nav>
  <div class="nav-logo">SIGBOTS <span>PARTS</span></div>
  <div class="nav-tabs">
    <button class="nav-tab active" id="tab-catalog"  onclick="showPage('catalog',this)">Catalog</button>
    <button class="nav-tab"        id="tab-myorders" onclick="showPage('myorders',this)">Orders</button>
    <button class="nav-tab"        id="tab-admin"    onclick="showPage('admin',this)" style="display:none">Admin ‚öô</button>
  </div>
  <div class="nav-right">
    <button class="cart-btn" onclick="openCart()">üõí Cart <span class="cart-count" id="cart-count">0</span></button>
    <button class="admin-link" onclick="openModal('admin-login-modal')">üîê Admin</button>
  </div>
</nav>

<!-- CATALOG -->
<div class="page active" id="page-catalog">
  <div class="parts-toolbar">
    <input class="search-input" type="text" id="search-input" placeholder="Search parts‚Ä¶" oninput="renderParts()"/>
    <button class="btn" onclick="openModal('add-part-modal')">+ Add Part</button>
  </div>
  <div class="parts-grid" id="parts-grid">
    <div class="loading"><div class="spinner"></div> Loading parts‚Ä¶</div>
  </div>
</div>

<!-- MY ORDERS -->
<div class="page" id="page-myorders">
  <div class="section-title">Order History</div>
  <div id="orders-list"><div class="loading"><div class="spinner"></div> Loading orders‚Ä¶</div></div>
</div>

<!-- ADMIN -->
<div class="page" id="page-admin">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
    <div class="section-title" style="margin-bottom:0">Admin Panel</div>
    <button class="btn secondary" onclick="adminLogout()">Logout</button>
  </div>
  <div class="admin-tabs">
    <button class="admin-tab active" id="atab-orders"   onclick="showAdminTab('orders',this)">Orders</button>
    <button class="admin-tab"        id="atab-parts"    onclick="showAdminTab('parts',this)">Manage Parts</button>
    <button class="admin-tab"        id="atab-settings" onclick="showAdminTab('settings',this)">Settings</button>
  </div>
  <div id="admin-orders-tab"></div>
  <div id="admin-parts-tab" style="display:none"></div>
  <div id="admin-settings-tab" style="display:none">
    <div style="max-width:420px;background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:20px;">
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;margin-bottom:10px">üîë Password Management</div>
      <p style="color:var(--muted);font-size:14px;line-height:1.6">Your password is managed securely through <b style="color:var(--text)">Firebase Authentication</b> ‚Äî not stored in this app at all.</p>
      <p style="color:var(--muted);font-size:14px;line-height:1.6;margin-top:10px">To change your password, go to:<br>
        <b style="color:var(--gold)">Firebase Console ‚Üí Authentication ‚Üí Users ‚Üí your email ‚Üí Reset password</b>
      </p>
    </div>
  </div>
</div>

<!-- CART -->
<div class="cart-overlay" id="cart-overlay" onclick="closeCart()"></div>
<div class="cart-drawer" id="cart-drawer">
  <div class="cart-header">
    <span class="cart-title">üõí Your Cart</span>
    <button class="close-btn" id="cart-close-btn">‚úï</button>
  </div>
  <div class="cart-items" id="cart-items-list"></div>
  <div class="cart-footer">
    <input class="finp" id="requester-name" placeholder="Your full name (required)"/>
    <textarea class="finp" id="order-notes" placeholder="Notes / justification (optional)"></textarea>
    <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">Payment Type</div>
    <div class="pay-opts">
      <button class="pay-opt active" id="pay-lead" onclick="selectPay('lead')">
        <span class="pay-opt-icon">üí≥</span>
        <span class="pay-opt-title">Lead Pays</span>
        <span class="pay-opt-sub">Mechanics lead covers it</span>
      </button>
      <button class="pay-opt" id="pay-self" onclick="selectPay('self')">
        <span class="pay-opt-icon">üßæ</span>
        <span class="pay-opt-title">Self Pay</span>
        <span class="pay-opt-sub">I pay + request reimbursement</span>
      </button>
    </div>
    <div class="cart-total">Total: <span id="cart-total">$0.00</span></div>
    <button class="btn" style="width:100%" onclick="submitOrder()">Submit Request</button>
  </div>
</div>

<!-- ADD PART MODAL -->
<div class="modal-overlay" id="add-part-modal">
  <div class="modal">
    <h3>‚ûï Add New Part</h3>
    <div class="form-group">
      <label class="form-label">Part Name *</label>
      <input class="form-control" id="np-name" placeholder="e.g. 1√ó2√ó35 C-Channel"/>
    </div>
    <div class="form-group">
      <label class="form-label">Price Per Unit ($) *</label>
      <input class="form-control" type="number" id="np-price" step="0.01" min="0" placeholder="0.00"/>
    </div>
    <div class="form-group">
      <label class="form-label">Product URL</label>
      <input class="form-control" id="np-url" placeholder="https://vexrobotics.com/‚Ä¶"/>
    </div>
    <div class="form-group">
      <label class="form-label">Category / Tag</label>
      <input class="form-control" id="np-tag" placeholder="e.g. Structure, Motion, Electronics"/>
    </div>
    <div class="form-group">
      <label class="form-label">Image (optional)</label>
      <div class="img-upload-area" id="img-upload-area" onclick="document.getElementById('np-img-file').click()">
        <div id="img-preview-wrap">
          <div style="font-size:28px">üì∑</div>
          <p>Click to upload an image</p>
        </div>
        <input type="file" id="np-img-file" accept="image/*" style="display:none" onchange="previewImage(event)"/>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('add-part-modal');resetPartForm()">Cancel</button>
      <button class="btn" id="add-part-btn" onclick="addPart()">Add Part</button>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN MODAL -->
<div class="modal-overlay" id="admin-login-modal">
  <div class="modal">
    <h3>üîê Admin Login</h3>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input class="form-control" type="email" id="admin-email" placeholder="your@email.com" onkeydown="if(event.key==='Enter')adminLogin()"/>
    </div>
    <div class="form-group">
      <label class="form-label">Password</label>
      <input class="form-control" type="password" id="admin-password" placeholder="Password" onkeydown="if(event.key==='Enter')adminLogin()"/>
    </div>
    <p id="login-error" style="color:var(--red);font-size:13px;min-height:18px"></p>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('admin-login-modal')">Cancel</button>
      <button class="btn" id="login-btn" onclick="adminLogin()">Login</button>
    </div>
  </div>
</div>

<!-- MODIFY ORDER MODAL -->
<div class="modal-overlay" id="modify-modal">
  <div class="modal">
    <h3>‚úèÔ∏è Modify & Approve Order</h3>
    <div id="modify-modal-items"></div>
    <div class="form-group" style="margin-top:14px">
      <label class="form-label">Admin Note (visible to requester)</label>
      <textarea class="form-control" id="modify-admin-note" style="min-height:70px;resize:vertical" placeholder="e.g. Approved with quantity changes due to budget"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('modify-modal')">Cancel</button>
      <button class="btn" onclick="saveModify()">Save & Approve</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp }                                      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, doc, addDoc, setDoc,
         updateDoc, deleteDoc, onSnapshot, orderBy, query }   from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut,
         onAuthStateChanged }                                  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const app = initializeApp({
  apiKey:            "AIzaSyAzS-srHQ3c8PDqAiPxlswoGro5AlaCIMA",
  authDomain:        "sigbots-parts.firebaseapp.com",
  projectId:         "sigbots-parts",
  storageBucket:     "sigbots-parts.firebasestorage.app",
  messagingSenderId: "899907444846",
  appId:             "1:899907444846:web:d558db7f81178f93fdc67f"
});
const db   = getFirestore(app);
const auth = getAuth(app);

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let parts  = [], orders = [], cart = [];
let currentUser    = null;
let payType        = 'lead';
let modifyingOrderId = null;
let pendingImgData   = null;

// ‚îÄ‚îÄ‚îÄ AUTH STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// This is the single source of truth ‚Äî Firebase tells us if logged in or not.
// No password is ever stored or checked in JS.
onAuthStateChanged(auth, user => {
  currentUser = user;
  if (user) {
    // Logged in ‚Äî show admin tab, go there
    document.getElementById('tab-admin').style.display = '';
    closeModal('admin-login-modal');
    document.getElementById('admin-email').value    = '';
    document.getElementById('admin-password').value = '';
    showPage('admin', document.getElementById('tab-admin'));
    showToast('üëã Welcome, Mechanics Lead!');
  } else {
    // Logged out ‚Äî hide admin tab, go to catalog
    document.getElementById('tab-admin').style.display = 'none';
    showPage('catalog', document.getElementById('tab-catalog'));
  }
});

// ‚îÄ‚îÄ‚îÄ FIRESTORE LISTENERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
onSnapshot(query(collection(db,'parts'), orderBy('created','asc')), snap => {
  parts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderParts();
  if (currentUser) renderAdminParts();
});

onSnapshot(query(collection(db,'orders'), orderBy('created','desc')), snap => {
  orders = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderOrders();
  if (currentUser) renderAdminOrders();
});

// ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.showPage = function(name, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'admin') renderAdmin();
};

// ‚îÄ‚îÄ‚îÄ PARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.renderParts = function() {
  const q    = (document.getElementById('search-input')?.value || '').toLowerCase();
  const grid = document.getElementById('parts-grid');
  const list = parts.filter(p => p.name.toLowerCase().includes(q) || (p.tag||'').toLowerCase().includes(q));
  if (!list.length) {
    grid.innerHTML = `<div class="empty-state"><div class="big">üì¶</div>
      <p>${parts.length ? 'No parts match your search.' : 'No parts yet.<br>Click <b>+ Add Part</b> to get started!'}</p></div>`;
    return;
  }
  grid.innerHTML = list.map(p => `
    <div class="part-card">
      <div class="part-img">${p.img ? `<img src="${p.img}" alt="${h(p.name)}" onerror="this.parentElement.innerHTML='üì¶'"/>` : 'üì¶'}</div>
      <div class="part-body">
        <div class="part-name">${h(p.name)}</div>
        <div class="part-price">$${Number(p.price).toFixed(2)} / unit</div>
        ${p.tag ? `<span class="part-tag">${h(p.tag)}</span>` : ''}
        ${p.url ? `<a class="part-link" href="${h(p.url)}" target="_blank" rel="noopener">‚Üó View Product</a>` : ''}
      </div>
      <div class="part-footer">
        <input class="qty-input" type="number" min="1" value="1" id="qty-${p.id}"/>
        <button class="add-btn" onclick="addToCart('${p.id}')">Add to Cart</button>
      </div>
    </div>`).join('');
};

window.previewImage = function(e) {
  const file = e.target.files[0]; if (!file) return;
  const img  = new Image();
  img.onload = () => {
    const MAX = 800; let w = img.width, wh = img.height;
    if (w > MAX) { wh = Math.round(wh * MAX / w); w = MAX; }
    const canvas = document.createElement('canvas');
    canvas.width = w; canvas.height = wh;
    canvas.getContext('2d').drawImage(img, 0, 0, w, wh);
    pendingImgData = canvas.toDataURL('image/jpeg', 0.82);
    document.getElementById('img-upload-area').classList.add('has-img');
    document.getElementById('img-preview-wrap').innerHTML =
      `<img src="${pendingImgData}" style="max-height:120px;border-radius:4px;object-fit:cover"/>
       <p style="margin-top:6px;font-size:11px">Click to change</p>`;
  };
  img.src = URL.createObjectURL(file);
};

window.resetPartForm = function() {
  ['np-name','np-price','np-url','np-tag'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  const fi = document.getElementById('np-img-file'); if (fi) fi.value='';
  pendingImgData = null;
  const area = document.getElementById('img-upload-area');
  if (area) { area.classList.remove('has-img'); document.getElementById('img-preview-wrap').innerHTML='<div style="font-size:28px">üì∑</div><p>Click to upload an image</p>'; }
};

window.addPart = async function() {
  const name  = document.getElementById('np-name').value.trim();
  const price = parseFloat(document.getElementById('np-price').value);
  if (!name)        { alert('Part name is required.'); return; }
  if (isNaN(price)) { alert('Price is required.'); return; }
  const btn = document.getElementById('add-part-btn');
  btn.textContent = 'Saving‚Ä¶'; btn.disabled = true;
  try {
    await addDoc(collection(db,'parts'), {
      name, price,
      url: document.getElementById('np-url').value.trim(),
      tag: document.getElementById('np-tag').value.trim(),
      img: pendingImgData || '', created: Date.now()
    });
    closeModal('add-part-modal'); resetPartForm(); showToast('‚úÖ Part added!');
  } catch(e) { alert('Error saving part: ' + e.message); }
  btn.textContent = 'Add Part'; btn.disabled = false;
};

// ‚îÄ‚îÄ‚îÄ CART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.selectPay = function(type) {
  payType = type;
  document.getElementById('pay-lead').classList.toggle('active', type==='lead');
  document.getElementById('pay-self').classList.toggle('active', type==='self');
};
window.addToCart = function(partId) {
  const qty = parseInt(document.getElementById('qty-'+partId)?.value) || 1;
  const ex  = cart.find(c => c.partId===partId);
  if (ex) ex.qty += qty; else cart.push({ partId, qty });
  updateCartCount(); showToast('üõí Added to cart!');
};
function updateCartCount() {
  document.getElementById('cart-count').textContent = cart.reduce((s,c)=>s+c.qty,0);
}
window.openCart  = function() { renderCartItems(); document.getElementById('cart-overlay').classList.add('open'); document.getElementById('cart-drawer').classList.add('open'); };
window.closeCart = function() { document.getElementById('cart-overlay').classList.remove('open'); document.getElementById('cart-drawer').classList.remove('open'); };

function renderCartItems() {
  const list = document.getElementById('cart-items-list');
  if (!cart.length) { list.innerHTML='<div class="empty-state"><p>Your cart is empty.</p></div>'; document.getElementById('cart-total').textContent='$0.00'; return; }
  let total = 0;
  list.innerHTML = cart.map((item,idx) => {
    const part = parts.find(p=>p.id===item.partId); if (!part) return '';
    const sub = part.price * item.qty; total += sub;
    return `<div class="cart-item">
      <div class="cart-item-info">
        <div class="cart-item-name">${h(part.name)}</div>
        <div class="cart-item-meta">Qty ${item.qty} √ó $${part.price.toFixed(2)} = <b>$${sub.toFixed(2)}</b></div>
      </div>
      <button class="cart-item-remove" onclick="removeFromCart(${idx})">‚úï</button>
    </div>`;
  }).join('');
  document.getElementById('cart-total').textContent = '$'+total.toFixed(2);
}
window.removeFromCart = function(idx) { cart.splice(idx,1); updateCartCount(); renderCartItems(); };

window.submitOrder = async function() {
  const name = document.getElementById('requester-name').value.trim();
  if (!name)        { alert('Please enter your name before submitting.'); return; }
  if (!cart.length) { alert('Your cart is empty.'); return; }
  const items = cart.map(c => {
    const part = parts.find(p=>p.id===c.partId);
    return { partId:c.partId, partName:part?.name||'Unknown', price:part?.price||0, qty:c.qty };
  });
  try {
    await addDoc(collection(db,'orders'), {
      name, notes: document.getElementById('order-notes').value.trim(),
      payType, items, status:'pending', shippingStatus:'', adminNote:'', created: Date.now()
    });
    cart=[]; document.getElementById('requester-name').value=''; document.getElementById('order-notes').value='';
    payType='lead'; selectPay('lead'); updateCartCount(); closeCart();
    showToast('‚úÖ Order submitted!');
    showPage('myorders', document.getElementById('tab-myorders'));
  } catch(e) { alert('Error submitting order: '+e.message); }
};

// ‚îÄ‚îÄ‚îÄ ORDER RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function statusClass(s) {
  if (s==='approved'||s==='modified-approved') return 'badge-approved';
  if (s==='denied') return 'badge-denied';
  if (s==='pending') return 'badge-pending';
  return 'badge-modified';
}
function statusLabel(s) {
  return s==='modified-approved' ? 'Modified & Approved' : s.charAt(0).toUpperCase()+s.slice(1);
}
window.renderOrders = function() {
  const list = document.getElementById('orders-list'); if (!list) return;
  list.innerHTML = orders.length
    ? orders.map(o=>orderHTML(o,false)).join('')
    : '<div class="empty-state"><div class="big">üìã</div><p>No orders submitted yet.</p></div>';
};
function orderHTML(o, isAdmin) {
  const total     = o.items.reduce((s,i)=>s+i.price*i.qty,0);
  const shipBadge = o.shippingStatus ? `<span class="badge ${o.shippingStatus==='shipped'?'badge-shipped':'badge-ordered'}">${o.shippingStatus}</span>` : '';
  const payBadge  = o.payType==='self' ? `<span class="badge badge-selfpay">üßæ Self Pay</span>` : `<span class="badge badge-leadpay">üí≥ Lead Pays</span>`;
  const itemsHTML = isAdmin
    ? o.items.map((i,idx) => {
        const part = parts.find(p=>p.id===i.partId);
        const url  = part?.url || '';
        return `<div class="buy-item">
          <div class="buy-item-num">${idx+1}</div>
          <div class="buy-item-info">
            <div class="buy-item-name">${h(i.partName)}</div>
            ${url ? `<a class="buy-item-link" href="${h(url)}" target="_blank" rel="noopener">üîó ${h(url)}</a>`
                  : `<span class="buy-item-link no-link">No link on file</span>`}
            <div class="buy-item-price">$${i.price.toFixed(2)} / unit</div>
          </div>
          <div class="buy-item-qty"><div class="qty-num">${i.qty}</div><div class="qty-label">qty</div></div>
          <div class="buy-item-sub">$${(i.price*i.qty).toFixed(2)}</div>
        </div>`;
      }).join('')
    : o.items.map(i=>`<div class="order-item-row"><span>${h(i.partName)}</span><span>√ó${i.qty} = $${(i.price*i.qty).toFixed(2)}</span></div>`).join('');
  return `<div class="order-card">
    <div class="order-card-header">
      <span class="order-name">${h(o.name)}</span>
      <span class="badge ${statusClass(o.status)}">${statusLabel(o.status)}</span>
      ${payBadge}${shipBadge}
      <span class="order-date">${new Date(o.created).toLocaleDateString()}</span>
    </div>
    <div class="order-items">${itemsHTML}</div>
    ${o.notes     ? `<div class="order-notes">üìù ${h(o.notes)}</div>` : ''}
    ${o.adminNote ? `<div class="order-admin-note">üí¨ Admin: ${h(o.adminNote)}</div>` : ''}
    <div class="order-total-bar">Total: <span>$${total.toFixed(2)}</span></div>
    ${isAdmin ? adminActionsHTML(o) : ''}
  </div>`;
}

// ‚îÄ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAdmin() {
  const active = document.querySelector('.admin-tab.active')?.id?.replace('atab-','') || 'orders';
  if (active==='orders') renderAdminOrders();
  if (active==='parts')  renderAdminParts();
}
window.showAdminTab = function(tab, btn) {
  document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active'));
  if (btn) btn.classList.add('active');
  ['orders','parts','settings'].forEach(t =>
    document.getElementById('admin-'+t+'-tab').style.display = t===tab ? '' : 'none'
  );
  if (tab==='orders') renderAdminOrders();
  if (tab==='parts')  renderAdminParts();
};
function renderAdminOrders() {
  const el = document.getElementById('admin-orders-tab');
  el.innerHTML = orders.length ? orders.map(o=>orderHTML(o,true)).join('') : '<div class="empty-state"><p>No orders yet.</p></div>';
}
function renderAdminParts() {
  const el = document.getElementById('admin-parts-tab');
  el.innerHTML = `<div style="margin-bottom:12px"><button class="btn" onclick="openModal('add-part-modal')">+ Add Part</button></div>` +
    (parts.length ? parts.map(p=>`<div class="parts-list-item">
      <div class="parts-list-thumb">${p.img?`<img src="${p.img}" onerror="this.parentElement.innerHTML='üì¶'"/>`:'üì¶'}</div>
      <div class="parts-list-info">
        <div class="parts-list-name">${h(p.name)}</div>
        <div class="parts-list-meta">$${Number(p.price).toFixed(2)}/unit${p.tag?' ¬∑ '+h(p.tag):''}${p.url?` ¬∑ <a href="${h(p.url)}" target="_blank" rel="noopener" style="color:var(--gold)">Link</a>`:''}</div>
      </div>
      <button class="btn danger" style="font-size:12px;padding:6px 12px" onclick="deletePart('${p.id}')">Delete</button>
    </div>`).join('') : '<div class="empty-state"><p>No parts in catalog yet.</p></div>');
}
function adminActionsHTML(o) {
  return `<div class="admin-actions">
    ${(o.status==='pending'||o.status==='denied')?`<button class="btn" style="font-size:12px;padding:7px 12px" onclick="quickApprove('${o.id}')">‚úÖ Approve</button>`:''}
    ${o.status!=='denied'?`<button class="btn danger" style="font-size:12px;padding:7px 12px" onclick="denyOrder('${o.id}')">‚úó Deny</button>`:''}
    <button class="btn secondary" style="font-size:12px;padding:7px 12px" onclick="openModify('${o.id}')">‚úèÔ∏è Modify</button>
    <select class="admin-select" onchange="updateShipping('${o.id}',this.value)">
      <option value="">Shipping‚Ä¶</option>
      <option value="ordered" ${o.shippingStatus==='ordered'?'selected':''}>Ordered</option>
      <option value="shipped" ${o.shippingStatus==='shipped'?'selected':''}>Shipped</option>
    </select>
    <button class="btn danger" style="font-size:12px;padding:7px 12px;margin-left:auto" onclick="deleteOrder('${o.id}')">üóë Delete</button>
  </div>`;
}
window.quickApprove   = async id => { await updateDoc(doc(db,'orders',id),{status:'approved'}); showToast('‚úÖ Order approved!'); };
window.denyOrder      = async id => { const note=prompt('Reason for denial (optional):')||''; await updateDoc(doc(db,'orders',id),{status:'denied',...(note&&{adminNote:note})}); showToast('Order denied.'); };
window.updateShipping = async (id,val) => { await updateDoc(doc(db,'orders',id),{shippingStatus:val}); };
window.deleteOrder    = async id => { if (!confirm('Permanently delete this order?')) return; await deleteDoc(doc(db,'orders',id)); };
window.deletePart     = async id => { if (!confirm('Delete this part?')) return; await deleteDoc(doc(db,'parts',id)); showToast('Part deleted.'); };

window.openModify = function(orderId) {
  modifyingOrderId = orderId;
  const o = orders.find(o=>o.id===orderId); if (!o) return;
  document.getElementById('modify-modal-items').innerHTML = o.items.map((item,idx)=>`
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:6px;padding:12px;margin-bottom:8px">
      <div style="font-weight:600;margin-bottom:8px">${h(item.partName)}</div>
      <div style="display:flex;gap:10px;align-items:center">
        <label style="font-size:12px;color:var(--muted)">Qty:</label>
        <input class="qty-input" type="number" min="0" value="${item.qty}" id="mq-${idx}" style="width:70px"/>
        <span style="font-size:13px;color:var(--muted)">√ó $${item.price.toFixed(2)}</span>
      </div>
    </div>`).join('');
  document.getElementById('modify-admin-note').value = o.adminNote||'';
  openModal('modify-modal');
};
window.saveModify = async function() {
  const o = orders.find(o=>o.id===modifyingOrderId); if (!o) return;
  const newItems = o.items.map((item,idx)=>({...item,qty:parseInt(document.getElementById('mq-'+idx)?.value)||0})).filter(i=>i.qty>0);
  await updateDoc(doc(db,'orders',modifyingOrderId),{items:newItems,adminNote:document.getElementById('modify-admin-note').value.trim(),status:'modified-approved'});
  closeModal('modify-modal'); showToast('‚úÖ Modified & approved!');
};

// ‚îÄ‚îÄ‚îÄ AUTH ‚Äî Firebase handles everything, no passwords in JS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.adminLogin = async function() {
  const email = document.getElementById('admin-email').value.trim();
  const pw    = document.getElementById('admin-password').value;
  const btn   = document.getElementById('login-btn');
  const err   = document.getElementById('login-error');
  err.textContent = ''; btn.textContent = 'Signing in‚Ä¶'; btn.disabled = true;
  try {
    await signInWithEmailAndPassword(auth, email, pw);
    // onAuthStateChanged above handles the rest
  } catch(e) {
    err.textContent = 'Incorrect email or password.';
  }
  btn.textContent = 'Login'; btn.disabled = false;
};
window.adminLogout = async function() {
  await signOut(auth);
  // onAuthStateChanged above handles the rest
};

// ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.openModal  = id => document.getElementById(id).classList.add('open');
window.closeModal = id => document.getElementById(id).classList.remove('open');
function h(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2600);
}
document.querySelectorAll('.modal-overlay').forEach(el =>
  el.addEventListener('click', e => { if (e.target===el) el.classList.remove('open'); })
);
document.getElementById('cart-close-btn').addEventListener('click', closeCart);

</script>
</body>
</html>